University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2024/2025

Group: K34202

Author: Rogozina Veronika Sergeevna

Lab: Lab4

Date of create: 17.10.2024

Date of finished: 27.12.2024

# Лабораторная работа №4 "Развертывание Netbox, сеть связи как источник правды в системе технического учета Netbox"

## Описание работы

В данной лабораторной работе вы познакомитесь на практике с языком программирования P4, разработанный компанией Barefoot (ныне Intel) для организации процесса обработки сетевого трафика на скорости чипа. Barefoot разработал несколько FPGA чипов для обработки трафика которые были встроенны в некоторые модели коммутаторов Arista и Brocade.

## Цель работы

Изучить синтаксис языка программирования P4 и выполнить 2 задания обучающих задания от Open network foundation для ознакомления на практике с P4.

## Ход выполнения работы

И вагрант и образ убунту уже были установлены у меня на ноутбуке, поэтому выполняем остальные пункту установки и получаем виртуальную машину

![Снимок экрана 2024-12-26 232035](https://github.com/user-attachments/assets/97346305-5ced-43f1-b6b7-4246b01046ce)

### Реализация базовой переадрессации 

Для начала запускаем miminet с помощью команды `make run`

![Снимок экрана 2024-12-26 232544](https://github.com/user-attachments/assets/4aaa61f0-48ba-4174-92ad-fdf6872cdf4a)

После этого пробуем отправить пакеты от коммутатора к коммутатору и между всеми коммутаторами. По умолчанию коммутатору сбрасывают все пинги, поэтому неудивительно, что результат их выполнения - ошибка. 

![Снимок экрана 2024-12-26 232926](https://github.com/user-attachments/assets/d556b15a-6872-41c7-9dd0-335bc3f85dff)

Для решения данной задачи необходимо внести изменения в файл basic.p4

В разделе Parsers добавлены парсеры `parse_ethernet` и `parse_ipv4`

![Снимок экрана 2024-12-26 234054](https://github.com/user-attachments/assets/f2fe1025-1313-4392-be01-da494abb5680)

В раздел Ingress processing добавлен дополнительный метод

![Снимок экрана 2024-12-26 234045](https://github.com/user-attachments/assets/e07bf77b-1b8a-4603-9472-d776058b697d)

В раздел Deparsers добавлен депарсинг созданных парсеров `parse_ethernet` и `parse_ipv4`

![Снимок экрана 2024-12-26 234026](https://github.com/user-attachments/assets/201b6051-74ce-465f-8ce5-0a71c53c05d7)

Теперь необходимо перезапустить mininet и попробовать отправить пакеты снова. 

![Снимок экрана 2024-12-26 233951](https://github.com/user-attachments/assets/6f64d377-5013-4557-8aef-a721ed1b6393)

Пакеты отправлены и получены успешно 

### Реализация базового туннелирования

Для решения данной задачи необходимо внести изменения в файл basic_tunnel.p4

В раздел Parsers добавлено состояние `parse_myTunnel`

![Снимок экрана 2024-12-27 002819](https://github.com/user-attachments/assets/225c03dc-b360-434e-9990-7a09091b6d6a)

В раздел Ingress processing добавлено дополнительное действие 

![Снимок экрана 2024-12-27 002811](https://github.com/user-attachments/assets/1b953532-41f2-4a24-918b-2ad99eab7638)

В раздел Deparsers добавлено преобразование пакетов туннелирования

![Снимок экрана 2024-12-27 002803](https://github.com/user-attachments/assets/6ee0df9e-1765-43d9-9d47-a9c7088e6bb7)

Перейдем к тестированию. Сначала было проведено тестирование без туннелирования. С h1 на h2 отправлен и успешно получен пакет. 

![Снимок экрана 2024-12-27 002421](https://github.com/user-attachments/assets/c5a7e195-4d42-4d53-a14b-11637472af3d)

Далее было проведено тестирование с туннелированием. В команду запуска было добавлено айди назначения. 

![Снимок экрана 2024-12-27 002558](https://github.com/user-attachments/assets/670dcbe3-2ce4-4e69-8fb1-70f5c48e4f45)

Затем я попробовала указать неправильный адрес назначения, однако пакет все рано был отправлен, так как коммутатор больше не использует заголовок айпи для маршрутизации. 

![Снимок экрана 2024-12-27 002628](https://github.com/user-attachments/assets/5317d3d3-e7d8-457a-89d6-6620c029d181)

## Вывод

В ходе выполнения данной лабораторной работы был изучен синтаксис языка программирования P4 и выполнено 2 обучающих задания от Open network foundation для ознакомления на практике с P4.
